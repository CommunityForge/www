---
title: "Home"
layout: default
---

{% include common/notification_modal.html %}

<section class='section'>
  <h1 class='title'>Become a Member</h1>
  <form id=mbs>
    <input type=hidden name=stripeToken id=stripeToken>
    <input type=hidden name=stripeMetadata id=stripeMetadata>
    <input type=hidden name=email id=email>
    <input type=hidden name=description value='Community Forge Membership'>
    <input type=hidden name=productId value='prod_CdNNverDybFRU1'>
    <div class="field is-narrow">
        <label class="label">Planning Committee</label>
        <div class="control">
          <div class="select">
            <select name='metadata[planning_committee]'>
              <option>Justice</option>
              <option>Arts</option>
              <option>Education</option>
              <option>Business</option>
              <option>Community Development</option>
              <option>None</option>
            </select>
          </div>
        </div>
        <p class="help">Pick a subject you'd like to help Community Forge plan for</p>
    </div>

    <div class="field is-narrow">
        <label class="label">T-Shirt Size</label>
        <div class="control">
          <div class="select">
            <select name='metadata[tshirt_size]'>
              <option>XS</option>
              <option>S</option>
              <option>M</option>
              <option>L</option>
              <option>XL</option>
              <option value=false>None</option>
            </select>
          </div>
        </div>
    </div>

    <div class="field is-narrow">
        <label class="label">Ideal Use of Funds</label>
        <div class="control">
          <div class="select">
            <select name='metadata[use_of_funds]'>
              <option>Free Events/Programming</option>
              <option>Subsidies for Community Organizations</option>
              <option>Building Beautification</option>
              <option>Operations</option>
            </select>
          </div>
        </div>
        <p class="help">Give us an idea of how you'd like this money to be spent</p>
    </div>

    <label class="label">Donation Amount</label>
    <div class="field has-addons">
        <div class="control has-icons-left">
            <input id='amount' class="input" name='amount' type="text" placeholder="Donation Amount">
            <span class="icon is-small is-left">
                <i class="fas fa-dollar-sign"></i>
            </span>
        </div>
        <div class="control">
          <div class="select">
            <select id='reocurring' name='reocurring'>
              <option value='true'>Monthly</option>
              <option value='false'>One Time</option>
            </select>
          </div>
        </div>
    </div>

    <div class="field">
        <button id=getMembership class="button is-primary">
            Become a Member!
        </button>
    </div>
  </form>
</section>

<script src="https://checkout.stripe.com/checkout.js"></script>

<script>
var handler = StripeCheckout.configure({
    key: '{{ site.stripe_public_token }}',
    locale: 'auto',
    name: 'Community Forge Membership',
    shippingAddress: true,
    billingAddress: true,
    zipCode: true,
    token: function(token, meta) {
        $('#mbs input#stripeToken').val(token.id);
        $('#mbs input#email').val(token.email);
        $('#mbs input#stripeMetadata').val(JSON.stringify(meta));
        url = '{{ site.stripe_webtask }}/stripe-payment/payment';

        notify_modal('<h1>Processing Order</h1><p><a class="button is-primary is-loading">Loading</a></p>')
            $.ajax({
                type: "POST",
                url: url,
                data: $("#mbs").serialize(), // serializes the form's elements.
                success: function(data) {
                    if (data.statusCode === undefined) {
                        notify_modal('<p>Order Complete!</p>', 'is-success');
                    } else {
                        notify_modal('<h1>Error</h1><p>' + data.message + '</p>', 'is-danger');
                    }
                },
                error: function(data) {
                    notify_modal('<h1>Error</h1><p>' + data + '</p>', 'is-danger');
                }
            });
    }
});

$('#getMembership').on('click', function(e) {
    e.preventDefault();
    var amount = $('#mbs input#amount').val();
    amount = amount.replace(/\$/g, '').replace(/\,/g, '');
    amount = parseFloat(amount);
    var reocurring = ($('#mbs select#reocurring').val() == 'true');

    var yearly_amount = (reocurring * 11 + 1) * amount;

    if (isNaN(amount)) {
        notify-modal('<p>Please enter a valid amount in USD ($).</p>', 'is-danger');
    }
    else if (yearly_amount < 50.00) {
        notify_modal('<p>Donation amount must be at least $50 annually.</p>', 'is-danger');
    }
    else {
        amount = amount * 100; // Needs to be an integer!
        handler.open({
            amount: Math.round(amount),
            panelLabel: '\{\{amount\}\}' + ((reocurring) ? ' per month' : '')
        })
    }
})
</script>
